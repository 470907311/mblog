<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="keywords" content="梁康伦,PHP,MySQL,liangkanglun,技术博客" />
        <meta name="description" content="梁康伦,PHP,MySQL,liangkanglun,技术博客 PHP集成开发工程师" />
        <title>梁康伦的博客</title>
        <link href="./css/bootstrap.min.css" rel="stylesheet">
        <style type="text/css">
            #title{width:100%; height:200px; background:#3DC5F9;}
            #ss{font-size:42px; top:60px; position:absolute; left:80px;}
            .form-group{position:absolute; left:700px; top:80px;}
            .container{width:100%;}
            .navbar-nav{margin-left:80px;}
            .navbar-nav li{margin-left:50px;}
            .column{margin-left:50px; border:1px solid #ddd;}

        </style>
    </head>
    <body>
        <div id="title">
            <span id="ss">梁康伦的博客</span>
            <form class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <input class="form-control" type="text" />
                    <button type="submit" class="btn btn-default">搜索</button>
                </div>
            </form>
        </div>
        <div class="container">
            <div class="row clearfix">
                    <nav class="navbar navbar-default" role="navigation">
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" >
                            <ul class="nav navbar-nav">
                                <li class="active">
                                     <a href="./index.html">首页</a>
                                </li>
                                <li>
                                     <a href="./phpbase.html">PHP</a>
                                </li>
                                <li>
                                     <a href="./master.html">MySQL</a>
                                </li>
                                <li>
                                     <a href="#">微信开发</a>
                                </li>
                                <li>
                                     <a href="#">git</a>
                                </li>
                                <li>
                                     <a href="#">工具</a>
                                </li>
                                <li>
                                     <a href="./zt.html">杂谈</a>
                                </li>
                            </ul>
                        </div>
                    </nav>
            </div>
            <div class="row clearfix">
                <div class="col-md-7 column">
                    <h2>
                        上传插件dropzone.js实例
                    </h2>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span><font size="4">作者：梁康伦</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <span><font size="4">时间：2016年12月23日</font></span>
                    <br>
                    <br>
                        <div class="post-content">
                            <p>
                                <p>dropzone.js默认是Ajax上传图片给服务器，那么如何获取到图片名呢？其实我们是可以通过dropzone的success函数获取到服务器返回的数据</p>
                                <p>dropzone.js在HTML的配置如下；</p>
                                <pre>

    Dropzone.autoDiscover = false;//防止报"Dropzone already attached."的错误
        $(".dropzone").dropzone({
        url: "__URL__/upload/",
        addRemoveLinks: true,
        dictRemoveLinks: "x",
        dictCancelUpload: "x",
        paramName:"userImg",
        maxFiles: 10,
        maxFilesize: 5,
        acceptedFiles: "image/*",
        init: function() {

            //res为服务器响应回来的数据
            this.on("success", function(file, res) {

                //将json字符串转换成json对象
                var obj = JSON.parse(res);

                console.log(obj);

                if( obj.status == 200 ){

                    //将服务器得到的数据生成一个隐藏域。做商品添加的时候就可以获取到了
                    var input = '&lt;input type="hidden" name="'+obj.details.savename+'" value="'+obj.details.savepath+obj.details.savename+'" /&gt;';
                    $('.myform').append(input);

                }else{
                    alert('上传失败');
                }



            });
            this.on("removedfile", function(file) {
                console.log("File " + file.name + "removed");
            });
        }
    });



                               </pre>
                            </p>
                            <p>PHP的代码如下(Thinkphp代码)：</p>
                            <pre>

    public function upload()
    {

        /*
          添加商品 ：商品名、商品图片
         */

           // 实例化上传类
          $upload = new \Think\Upload();

           // 设置附件上传大小
          $upload->maxSize   =     3145728 ;

        // 设置附件上传类型
          $upload->exts      =     array('jpg', 'gif', 'png', 'jpeg');

//A开发者写了upload()   B开发
          // 设置附件上传目录
           $upload->savePath  =      './Public/Uploads/';


          //返回上传信息
          $info   =   $upload->uploadOne($_FILES['userImg']);
          // dump($info);exit;
          if( !$info ) {
            // 上传错误提示错误信息
              // $this->error($upload->getError());
              $data['status'] = 404;

              //错误信息
              $data['msg']    = $upload->getError();

              echo  json_encode($data);

          }else{
            // 上传成功 (图片路径、图片名字)

              $data['status']  = 200;
              $data['msg']     = 'UPLOAD SUCCESS';

              //图片原始名字
              $data['details']['originName'] = $info['name'];
              $data['details']['savename'] = $info['savename'];
              $data['details']['savepath'] = $info['savepath'];

              echo json_encode($data);
          }
   }
                            </pre>
                        </div>
                      <br>
                    <br>
                </div>
                <div class="col-md-4 column">
                    <h3>博文链接</h3>
                    <ul>
                        <li>
                            <a href="./gd.html">GD库函数使用</a>
                        </li>
                        <li>
                            <a href="./git.html">如何在github上搭建自己的博客</a>
                        </li>
                        <li>
                            <a href="./master.html">MySQL主从配置</a>
                        </li>
                        <li>
                            <a href="./phpbase.html">echo print print_r var_dump的区别</a>
                        </li>
                        <li>
                            <a href="./phpnotice.html">50个提高PHP运行效率的细节</a>
                        </li>
                        <li>
                            <a href="./gitserver.html">如何在Linux搭建git服务器</a>
                        </li>
                        <li>
                            <a href="./yz.html">php-安全隐藏</a>
                        </li>
                        <li>
                            <a href="./upload.html">上传插件dropzone.js实例</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    </body>
</html